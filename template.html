<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripeflare Demo</title>
    <style>
        h1 {
            color: #635bff;
        }

        .payment-button {
            background: #635bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 10px 0;
        }

        .toggle-privacy {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .blurred-value {
            filter: blur(5px);
            user-select: none;
        }

        .info-container {
            margin: 5px 0;
        }

        .info-label {
            font-weight: bold;
        }

        .message-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #635bff;
        }
    </style>
</head>

<body>
    <h1>Stripeflare Demo</h1>
    <div id="client_reference_id"></div>
    <div class="info-container">
        <span class="info-label">Email: </span>
        <span id="email-value"></span>
    </div>
    <div class="info-container">
        <span class="info-label">Name: </span>
        <span id="name-value"></span>
    </div>
    <div id="balance"></div>
    <div id="speed"></div>
    <div id="charged"></div>
    <div id="message-container" class="message-container" style="display: none;">
        <span class="info-label">Message: </span>
        <span id="message-value"></span>
    </div>
    <a id="paymentLink" target="_blank" href="#" class="payment-button">Pay with Stripe</a>
    <p>After paying, every request will charge $0.01 without limit to showcase speed</p>
    <button id="togglePrivacy" class="toggle-privacy">Toggle Privacy</button>
    <script>
        // Initialize privacy setting from localStorage or default to false
        let isPrivacyEnabled = JSON.parse(localStorage.getItem('privacyEnabled')) || false;

        // Function to update UI based on privacy setting
        function updatePrivacyUI() {
            const emailValue = document.getElementById('email-value');
            const nameValue = document.getElementById('name-value');
            if (isPrivacyEnabled) {
                emailValue.classList.add('blurred-value');
                nameValue.classList.add('blurred-value');
            } else {
                emailValue.classList.remove('blurred-value');
                nameValue.classList.remove('blurred-value');
            }
        }

        // Toggle privacy button event listener
        document.getElementById('togglePrivacy').addEventListener('click', function () {
            isPrivacyEnabled = !isPrivacyEnabled;
            localStorage.setItem('privacyEnabled', JSON.stringify(isPrivacyEnabled));
            updatePrivacyUI();
        });

        // Check for user_data and extract client_reference_id
        if (window.data) {
            const { client_reference_id, balance, email, name, speed, charged, message } = window.data;
            if (client_reference_id) {
                // Construct the payment link with client_reference_id
                const paymentUrl = `https://buy.stripe.com/fZe9Do2HB0DHeX06UP?client_reference_id=${client_reference_id}`;
                // const paymentUrl = `https://buy.stripe.com/cN2bLw81V725eX04MJ?client_reference_id=${client_reference_id}`
                document.getElementById('paymentLink').href = paymentUrl;
                document.getElementById('balance').innerText = 'Balance: $' + balance / 100;
                document.getElementById('email-value').innerText = email || "Unavailable";
                document.getElementById('name-value').innerText = name || "Unavailable";
                document.getElementById('speed').innerText = 'Speed: ' + speed + "ms";
                document.getElementById('client_reference_id').innerText = 'Client ID: ' + client_reference_id;

                // Display charged amount if available
                if (charged !== undefined) {
                    document.getElementById('charged').innerText = 'Charged: $' + charged / 100;
                }

                // Display message if available
                if (message) {
                    document.getElementById('message-value').innerText = message;
                    document.getElementById('message-container').style.display = 'block';
                }

                // Apply privacy settings
                updatePrivacyUI();
            } else {
                alert('Error: No client reference ID found');
            }
        }
    </script>
</body>

</html>